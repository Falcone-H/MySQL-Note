# SQL 学习笔记

## 存储引擎

存储引擎是一个表存储 / 组织数据的方式。

## 给表指定存储引擎

下面的语句可以查看已创建表的存储引擎

```mysql
show create table 表名
```

可以用`engine`来指定存储引擎

用`charset`来指定字符集

MySQL默认的存储引擎是：`InnoDB`

MySQL默认的字符编码方式：`utf8`

```
create table 表名(
字段名 数据类型
)engine=innodb default charset=utf8;
```

## 查看MySQL支持的搜索引擎

```mysql
show engines \G
```

## 事务

`transaction`

一个事务其实就是一个完整的业务逻辑

只有`insert`，`delete`，`update`三个语句和事务有关

事务：就是批量的DML语句同时成功，或者同时失败

在事务的执行过程中，每一条DML的操作都会记录到“事务性活动的日志文件”中

在事务的执行过程中，我们可以提交事务，也可以回滚事务

### 提交事务

清空事务性活动的日志文件，将数据全部彻底持久化到数据库表中

提交事务标志着，事务的结束，并且是一种全部成功的结束

`commit;`

### 回滚事务

将之前所有的DML操作全部撤销，并且清空事务性活动的日志文件

回滚事务标志着，事务的结束，并且是一种全部失败的结束

`rollback;`

可以回滚到上一次的提交点



MySQL默认情况下是支持自动提交事务的。

每执行一次DML语句，则提交一次

## 关闭自动提交机制

```mysql
start transaction;
```

开启事务

## 提交事务

```mysql
commit;
```

## 回滚事务

```mysql
rollback;
```

## 事务的四个特性：

* 原子性

  说明事务是最小的工作单元，不可再分。

* 一致性

  所有事务要求，在同一个书屋中，所有的操作必须同时成功，同时失败。

* 隔离性

  A事务和B事务之间具有一定的隔离

* 持久性

  事务最终结束的一个保障。事务提交，就相当于将没有保存到硬盘上的数据保存到硬盘上。

## 事务和事务之间的隔离级别

* 读未提交：`read uncommitted`

  可能出现脏读

  事务A可以读取到事务B未提交的数据

* 读已提交：`read committed`

  已解决脏读，但不可重复读取数据

  事务A只能读取到事务B已提交的数据

* 可重复读：`repeatable read`

  事务A开启之后，不管过久，每一次在事务A中读取到的数据都是一致的，即使事务B将数据已经修改，并且提交。永远读取到的都是开启事务时的数据。

* 序列化 / 串行化：`serializable`（最高的隔离级别）

  效率最低，这种隔离级别表示事务排队，不能并发。

  事务A只能等事务B提交之后，再查看数据

## 查看隔离级别

```mysql
select @@tx_isolation
```

## 设置事务隔离级别

```mysql
set global transaction isolation level read uncommitted;
```
